# クイックオーダー機能仕様書

## 概要

クイックオーダーは、商品コードを直接入力して複数商品を一括でカートに追加できる機能です。BtoBビジネスにおいて、リピート注文や大量注文を効率化します。

**最終更新日**: 2025-11-07

## 機能概要

### 基本機能

- **複数行入力**: 初期20行、最大99行まで追加可能（10行ずつ追加）
- **リアルタイム商品検索**: 商品コード入力時に自動で商品情報を取得
- **デバウンス処理**: 入力から500ms後に検索実行（API負荷軽減）
- **一括カート追加**: 入力済み商品をまとめてカートに追加
- **行リセット機能**: 各行の入力内容を個別にリセット可能
- **デモデータ入力**: 左下のフローティングボタンからデモデータを一括入力

### 対応商品タイプ

1. **通常商品**: 在庫あり・購入可能な商品
2. **在庫切れ商品**: 在庫なし・購入不可の商品
3. **中止品（廃番商品）**: 販売終了した商品
4. **代替商品**: 中止品に対する代替提案商品

## UIコンポーネント構成

### 階層構造（Atomic Design）

```
QuickOrderMultiLineForm (Organism)
  └─ QuickOrderTable (Organism)
       └─ QuickOrderTableRow (内部コンポーネント)
            └─ QuickOrderRow (Molecule)
                 ├─ ProductCodeInput (Molecule)
                 └─ NumberInput (Atom)
```

### ファイル構成

```
src/components/quick-order/
├── QuickOrderRow.tsx                    # 1行入力コンポーネント
├── QuickOrderTable.tsx                  # テーブル全体
├── QuickOrderMultiLineForm.tsx          # フォーム全体（カート追加機能含む）
└── __tests__/
    ├── QuickOrderRow.test.tsx
    ├── QuickOrderTable.test.tsx
    └── QuickOrderMultiLineForm.test.tsx
```

## レイアウト仕様

### コンパクト化の目標

デザインレビュー（2025-11-07実施）に基づき、以下の縦サイズ削減を達成：

- **中止品表示**: 約50%削減
- **代替商品表示**: 約60%削減
- **通常商品表示**: 約30%削減

### 画像サイズ

| 要素 | 変更前 | 変更後 |
|------|--------|--------|
| 中止品画像 | 64x64px | 40x40px |
| 代替商品画像 | 48x48px | 40x40px |
| 通常商品画像 | 64x64px | 48x48px |

### パディング・余白

| 要素 | 値 |
|------|-----|
| ボックス内パディング | `p-2` (8px) |
| 要素間の間隔 | `gap-2` (8px) |
| 角丸 | `rounded-md` |

### フォントサイズ

| 要素 | サイズ |
|------|--------|
| ラベル（中止品、代替商品） | `text-xs` (12px) |
| 商品名 | `text-sm` (14px) |
| 詳細情報（コード、価格） | `text-xs` (12px) |

## 商品表示仕様

### 1. 中止品（廃番商品）

**表示条件**: `product.discontinued === true`

**レイアウト**:
```
[中止品] [画像40x40] コード: XXX | YYYY-MM-DD廃番 | 廃番理由
```

**スタイル**:
- 背景色: `bg-orange-50`
- 枠線: `border-orange-300`
- ラベル色: `text-orange-900`
- 画像: グレースケール + 透明度60%

**データ構造**:
```typescript
{
  discontinued: true,
  discontinuedDate: '2024-12-01',
  discontinuedReason: 'モデルチェンジのため廃番',
  alternativeProducts?: Product[]
}
```

### 2. 代替商品

**表示条件**: `product.discontinued === true && product.alternativeProducts.length > 0`

**レイアウト**:
```
[代替商品] [画像40x40] 商品名 | コード: XXX | ¥価格  [切替ボタン]
```

**仕様**:
- **表示件数**: 最初の1件のみ表示（複数ある場合も1件目のみ）
- **高さ**: 中止品表示と同じ高さに統一
- **切り替えボタン**: クリックで代替商品コードに切り替え

**スタイル**:
- 背景色: `bg-blue-50`
- 枠線: `border-blue-200`
- ラベル色: `text-blue-900`
- 切り替えボタン: `bg-blue-600`

### 3. 通常商品

**表示条件**: `product && !product.discontinued && product.isAvailable`

**レイアウト**:
```
[画像48x48] 商品名 | コード: XXX
            ¥価格（税込 ¥価格）| 在庫: XX個
```

**スタイル**:
- 背景色: `bg-white` （枠線なし）
- ホバー時: `hover:bg-gray-50`
- 商品詳細ページへのリンク機能あり

### 4. 在庫切れ商品

**表示条件**: `product && !product.discontinued && !product.isAvailable`

**レイアウト**: 通常商品と同じ

**スタイル**:
- 在庫表示: `bg-red-100 text-red-800` 「在庫切れ」バッジ

### 5. エラー表示

**表示条件**: `error && !product && !isSearching`

**レイアウト**:
```
❌ エラーメッセージ
```

**スタイル**:
- 背景色: `bg-red-50`
- 枠線: `border-red-200`
- テキスト色: `text-red-700`

### 6. 検索中表示

**表示条件**: `isSearching`

**レイアウト**:
```
[スピナー] 検索中...
```

**スタイル**:
- 背景色: `bg-blue-50`
- 枠線: `border-blue-200`
- テキスト色: `text-blue-700`
- スピナー: 単色SVGアニメーション

## デザインルール

### アイコン使用規則（開発ルール11）

**禁止事項**:
- 絵文字アイコンの使用（❌、⚠️、💡、✅ など）

**推奨**:
- 単色SVGアイコンのみ使用
- `stroke="currentColor"` または `fill="currentColor"` を使用
- デザインシステムとの一貫性を保つ

### カラーパレット

| 用途 | 背景 | 枠線 | テキスト |
|------|------|------|----------|
| 中止品 | `bg-orange-50` | `border-orange-300` | `text-orange-900` |
| 代替商品 | `bg-blue-50` | `border-blue-200` | `text-blue-900` |
| 通常商品 | `bg-white` | なし | `text-gray-900` |
| エラー | `bg-red-50` | `border-red-200` | `text-red-700` |
| 検索中 | `bg-blue-50` | `border-blue-200` | `text-blue-700` |

### プライマリーカラー

**カート追加ボタン**:
- 通常時: `bg-[#2d2626]`
- ホバー時: `hover:bg-gray-900`
- アクティブ時: `active:bg-black`
- 無効時: `bg-gray-400`

## インタラクション仕様

### 商品コード入力

1. **入力開始**: ユーザーが商品コード入力
2. **デバウンス**: 500ms待機
3. **検索実行**: API呼び出し（`useProductSearch` フック）
4. **結果表示**: 商品情報 or エラー表示

### 代替商品切り替え

1. **切り替えボタンクリック**: `onSwitchToAlternative(alternativeCode)`
2. **商品コード更新**: 代替商品コードに置き換え
3. **再検索**: 新しい商品コードで自動検索

### 行リセット

1. **リセットボタンクリック**: `onReset()`
2. **入力クリア**: 商品コード = "", 数量 = 1
3. **商品情報クリア**: product = null, error = null

### カート追加

1. **ボタンクリック**: 入力済み商品を抽出
2. **一括追加**: `onAddToCart(items)` 実行
3. **成功時**: フォームリセット（初期20行に戻る）
4. **エラー時**: エラーメッセージ表示

## テスト仕様

### テストカバレッジ

- **ユニットテスト**: Jest + React Testing Library
- **カバレッジ目標**: 60%以上
- **テストファイル**: `__tests__/` ディレクトリ

### 主要テストケース

**QuickOrderRow.test.tsx**:
- ✓ 行番号が正しく表示されること
- ✓ 商品コード入力時にonProductCodeChangeが呼ばれること
- ✓ 数量変更時にonQuantityChangeが呼ばれること
- ✓ 検索中インジケーターが表示されること
- ✓ 商品情報が正しく表示されること
- ✓ エラーメッセージが表示されること
- ✓ 在庫切れ商品の場合に警告が表示されること
- ✓ 商品情報がない場合は何も表示されないこと
- ✓ 廃番商品の警告が表示されること（コンパクトレイアウト、中止品）
- ✓ 代替商品が1つ表示されること（コンパクト、通常商品と同じ高さ）
- ✓ 代替商品の切り替えボタンをクリックするとonSwitchToAlternativeが呼ばれること
- ✓ 商品コードが入力されている場合、リセットボタンが有効になること
- ✓ 商品コードが空の場合、リセットボタンが無効になること

## パフォーマンス最適化

### デバウンス処理

- 商品コード入力: 500ms デバウンス
- API呼び出し回数削減
- ユーザー入力のレスポンス向上

### メモ化

```typescript
// 入力済み行のメモ化
const filledRows = useMemo(() => {
  return rows.filter((row) => row.productCode.trim().length > 0);
}, [rows]);
```

## デモデータ

### サンプル商品コード

| 商品コード | 状態 | 説明 |
|-----------|------|------|
| AWA4132 | ✓ 通常商品 | A4コピー用紙 |
| DM110BK | ⚠️ 中止品 | デスクマット → 代替商品あり |
| AW75238 | ✓ 通常商品 | オフィスチェア |
| TN2200 | ⚠️ 中止品 | テープのり → 代替商品あり |
| 8027341 | ✓ 通常商品 | ボールペン |
| XXXXX | ✗ エラー | 存在しない商品（エラー表示確認用） |

### デモデータボタン

- **位置**: 左下フローティング（`bottom: 62px, left: 32px`）
- **機能**: デモデータを最初の6行に一括入力
- **スタイル**: `bg-blue-600` 青色丸ボタン

## アクセシビリティ

### ARIA属性

- `aria-label`: リセットボタン、デモデータボタン
- ボタンの無効状態を適切に反映
- キーボードナビゲーション対応

### フォーカス管理

- 入力フィールドの順序: 商品コード → 数量 → 次の行
- リセットボタン: 入力内容がない場合は無効化

## 今後の拡張予定

1. **CSVインポート**: 大量商品コードの一括入力
2. **履歴機能**: 過去の注文履歴から再注文
3. **お気に入りリスト**: よく注文する商品のテンプレート保存
4. **バーコード入力**: ハンディスキャナー対応

## 関連ドキュメント

- [デザインレビュー: クイックオーダーレイアウトコンパクト化](/docs/design-review/quick-order-layout-compact.md)
- [開発ルール: CLAUDE.md](/CLAUDE.md)
- [Atomic Designガイド](/docs/architecture/atomic-design.md)

## 変更履歴

### 2025-11-07
- コンパクトレイアウト実装（画像サイズ削減、パディング削減）
- 「廃番商品」→「中止品」表記変更
- テキストを画像の左側に配置
- 代替商品表示を3件横スクロール → 1件表示に変更
- 絵文字アイコン削除（開発ルール追加）
- 通常商品の背景色・枠線削除
- カート追加ボタンをプライマリーカラーに変更

---

**作成者**: Claude Code
**承認**: UIデザイナー（デザインレビュー実施済み）
**バージョン**: 1.0
